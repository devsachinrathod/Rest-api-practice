<!DOCTYPE html>
<html lang="en">

<head>
    <title>Personal Talks üí¨</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        body {
            font-family: "Poppins", Arial, sans-serif;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e1f29, #23272a, #181a1f);
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* === MOVING BACKGROUND TEXT === */
        /* === Moving background text animation === */
        .moving-text-bg {
            position: fixed;
            inset: 0;
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
            opacity: 0.12;
        }

        .bg-line {
            position: absolute;
            white-space: nowrap;
            font-size: 2.8em;
            font-weight: 700;
            text-transform: uppercase;
            font-family: "Poppins", sans-serif;
            width: max-content;
            opacity: 0.5;
            filter: blur(0.3px);
        }

        /* Alternate directions + positions */
        .line1 {
            top: 20%;
            color: #43b581;
            animation: moveRight 25s linear infinite;
        }

        .line2 {
            top: 40%;
            color: #7289da;
            animation: moveLeft 27s linear infinite;
        }

        .line3 {
            top: 60%;
            color: #ff6b81;
            animation: moveRight 29s linear infinite;
        }

        .line4 {
            top: 80%;
            color: #feca57;
            animation: moveLeft 31s linear infinite;
        }

        /* Smooth infinite motion */
        @keyframes moveRight {
            0% {
                transform: translateX(-100vw);
            }

            100% {
                transform: translateX(100vw);
            }
        }

        @keyframes moveLeft {
            0% {
                transform: translateX(100vw);
            }

            100% {
                transform: translateX(-100vw);
            }
        }

        /* === CHAT CONTAINER === */
        .chat-container {
            position: relative;
            border-radius: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6), 0 0 30px rgba(67, 181, 129, 0.2);
            padding: 24px;
            max-width: 520px;
            width: 90%;
            display: flex;
            flex-direction: column;
            height: 85vh;
            backdrop-filter: blur(10px);
            animation: floatUp 1.2s ease-out;
            overflow: hidden;
            background: rgba(44, 47, 51, 0.85);
            z-index: 1;
        }

        .chat-container::before {
            background-color: rgb(119, 131, 132);
            content: "";
            position: absolute;
            inset: 0;
            opacity: 0.25;
            z-index: 0;
        }

        .chat-container>* {
            position: relative;
            z-index: 1;
        }

        @keyframes floatUp {
            0% {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }

            100% {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .glow-active {
            box-shadow: 0 0 25px rgba(67, 181, 129, 0.5), 0 0 15px rgba(114, 137, 218, 0.4);
        }

        .chat-heading {
            text-align: center;
            font-family: 'Poppins', sans-serif;
            font-size: 1.8em;
            color: #ffffff;
            margin-bottom: 16px;
            text-shadow: 0 0 15px rgba(67, 181, 129, 0.5);
            letter-spacing: 1px;
            animation: pulseText 3s infinite ease-in-out;
        }

        @keyframes pulseText {

            0%,
            100% {
                text-shadow: 0 0 10px rgba(67, 181, 129, 0.5);
            }

            50% {
                text-shadow: 0 0 25px rgba(67, 181, 129, 0.8);
            }
        }

        .chat-log {
            flex-grow: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth;
        }

        .chat-message {
            display: inline-block;
            max-width: 80%;
            padding: 10px 16px;
            border-radius: 14px;
            background: linear-gradient(135deg, #7289da, #43b581);
            color: #fff;
            font-weight: 500;
            word-wrap: break-word;
            opacity: 0;
            transform: translateY(20px) scale(0.9);
            animation: fadeSlideIn 0.5s forwards;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
        }

        @keyframes fadeSlideIn {
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        .chat-message img {
            max-width: 200px;
            border-radius: 8px;
            margin-top: 6px;
            display: block;
        }

        .input-row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            padding-top: 8px;
        }

        input[type="text"] {
            flex: 1;
            padding: 12px 16px;
            border-radius: 8px;
            border: none;
            background: #1e2124;
            color: #fff;
            font-size: 1em;
            border-bottom: 2px solid #7289da;
            transition: 0.3s;
        }

        input[type="text"]:focus {
            border-color: #43b581;
            box-shadow: 0 0 8px rgba(67, 181, 129, 0.3);
        }

        button {
            border: none;
            cursor: pointer;
            transition: 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .send-btn {
            background: linear-gradient(135deg, #43b581, #7289da);
            color: #fff;
            padding: 10px 18px;
            border-radius: 8px;
            font-size: 1.05em;
            font-weight: 600;
        }

        .emoji-btn,
        .image-btn {
            background: #2c2f33;
            color: #7289da;
            border: 2px solid #7289da;
            font-size: 1.3em;
            padding: 7px 10px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            transition: 0.25s;
        }

        .emoji-btn:hover,
        .image-btn:hover {
            background: #43b581;
            border-color: #43b581;
            color: white;
            transform: rotate(15deg) scale(1.2);
        }

        #voiceBtn {
            background: #ff4757;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            font-size: 1.3em;
            transition: 0.3s;
        }

        #voiceBtn.recording {
            background: #2ecc71;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                box-shadow: 0 0 0 0 rgba(46, 204, 113, 0.7);
            }

            50% {
                box-shadow: 0 0 10px 10px rgba(46, 204, 113, 0);
            }
        }

        /* Pulse the background lines when new message arrives */
        .flash-bg {
            animation: flashLines 1.5s ease;
        }

        @keyframes flashLines {
            0% {
                opacity: 0.3;
                filter: brightness(2);
            }

            100% {
                opacity: 0.08;
                filter: brightness(1);
            }
        }

        /* Image preview animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            from {
                opacity: 1;
            }

            to {
                opacity: 0;
            }
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }

            to {
                transform: scale(1);
                opacity: 1;
            }
        }
    </style>
</head>

<body>
    <!-- Animated background text -->
    <!-- Animated background text -->
    <div class="moving-text-bg" id="movingBg">
        <div class="bg-line line1">üí¨ Personal Talks ‚Ä¢ Deep Conversations ‚Ä¢ Real Emotions ‚Ä¢ Stay Connected ‚Ä¢</div>
        <div class="bg-line line2">‚ú® Share Moments ‚Ä¢ Laugh Together ‚Ä¢ Feel Alive ‚Ä¢ Make Memories ‚Ä¢</div>
        <div class="bg-line line3">üåô Night Chats ‚Ä¢ Honest Thoughts ‚Ä¢ True Friends ‚Ä¢ Open Hearts ‚Ä¢</div>
        <div class="bg-line line4">üéß Listen ‚Ä¢ Speak ‚Ä¢ Feel ‚Ä¢ Inspire ‚Ä¢ Support ‚Ä¢ Grow ‚Ä¢</div>
    </div>


    <div class="chat-container">
        <h2 class="chat-heading">Personal Talks üí¨</h2>

        <div id="chat" class="chat-log"></div>

        <div class="input-row">
            <input id="messageInput" type="text" placeholder="Type a message..." />
            <button class="send-btn" onclick="sendMessage()">Send</button>
            <button class="emoji-btn" onclick="addEmoji('üòÑ')">üòÑ</button>
            <button class="emoji-btn" onclick="addEmoji('üî•')">üî•</button>
            <button class="emoji-btn" onclick="addEmoji('‚ù§Ô∏è')">‚ù§Ô∏è</button>
            <button class="emoji-btn" onclick="addEmoji('üéâ')">üéâ</button>
            <button class="image-btn" onclick="selectImage()">üì∑</button>
            <input type="file" id="imageInput" accept="image/*" hidden />
            <button id="voiceBtn" title="Hold to record üé§">üé§</button>
        </div>
    </div>

    <script>
        const ws = new WebSocket("ws://localhost:3001");
        const chat = document.getElementById("chat");
        const input = document.getElementById("messageInput");
        const voiceBtn = document.getElementById("voiceBtn");
        const imageInput = document.getElementById("imageInput");
        const bg = document.getElementById("movingBg");
        let mediaRecorder, audioChunks = [];

        ws.onopen = () => addChatLine("‚úÖ Connected to server");
        ws.onclose = () => addChatLine("‚ùå Disconnected");

        ws.onmessage = (event) => {
            const msg = event.data;
            if (msg.startsWith("voice:")) playVoice(msg.slice(6));
            else if (msg.startsWith("img:")) addImageToChat(msg.slice(4));
            else addChatLine(msg);
        };

        function sendMessage() {
            const msg = input.value.trim();
            if (!msg) return;
            ws.send(msg);
            addChatLine("üü¢ You: " + msg);
            input.value = "";
        }

        function addEmoji(e) {
            input.value += e;
            input.focus();
        }

        function pulseBackground() {
            bg.classList.remove("flash-bg");
            void bg.offsetWidth; // reset animation
            bg.classList.add("flash-bg");
        }
        document.querySelector('.chat-container').classList.add('glow-active');
        setTimeout(() => document.querySelector('.chat-container').classList.remove('glow-active'), 800);


        function addChatLine(text) {
            const msg = document.createElement("div");
            msg.className = "chat-message";
            msg.textContent = text;
            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight;
            pulseBackground(); // trigger glow
        }

        function selectImage() {
            imageInput.click();
        }

        imageInput.addEventListener("change", () => {
            const file = imageInput.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = () => {
                ws.send("img:" + reader.result);
                addImageToChat(reader.result, true);
            };
            reader.readAsDataURL(file);
        });

        function addImageToChat(src, isSelf = false) {
            const msg = document.createElement("div");
            msg.className = "chat-message";
            msg.innerHTML = (isSelf ? "üü¢ You:<br>" : "") + `<img src="${src}" alt="sent image">`;
            const img = msg.querySelector("img");

            img.addEventListener("click", () => openImagePreview(src));
            chat.appendChild(msg);
            chat.scrollTop = chat.scrollHeight;
            pulseBackground();
        }

        function openImagePreview(src) {
            const overlay = document.createElement("div");
            overlay.style.position = "fixed";
            overlay.style.top = "0";
            overlay.style.left = "0";
            overlay.style.width = "100vw";
            overlay.style.height = "100vh";
            overlay.style.background = "rgba(0,0,0,0.9)";
            overlay.style.display = "flex";
            overlay.style.alignItems = "center";
            overlay.style.justifyContent = "center";
            overlay.style.zIndex = "9999";
            overlay.style.animation = "fadeIn 0.3s ease";

            const img = document.createElement("img");
            img.src = src;
            img.style.maxWidth = "90%";
            img.style.maxHeight = "90%";
            img.style.borderRadius = "12px";
            img.style.boxShadow = "0 0 20px rgba(255,255,255,0.3)";
            img.style.animation = "zoomIn 0.3s ease";
            overlay.appendChild(img);

            document.body.appendChild(overlay);
            overlay.addEventListener("click", () => closeImagePreview(overlay));
            document.addEventListener("keydown", function escClose(e) {
                if (e.key === "Escape") {
                    closeImagePreview(overlay);
                    document.removeEventListener("keydown", escClose);
                }
            });
        }

        function closeImagePreview(overlay) {
            overlay.style.animation = "fadeOut 0.3s ease";
            setTimeout(() => overlay.remove(), 300);
        }

        input.addEventListener("keydown", (e) => e.key === "Enter" && sendMessage());

        // === üé§ Voice Message ===
        voiceBtn.addEventListener("mousedown", startRec);
        voiceBtn.addEventListener("mouseup", stopRec);
        voiceBtn.addEventListener("touchstart", startRec);
        voiceBtn.addEventListener("touchend", stopRec);

        async function startRec() {
            const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
            mediaRecorder = new MediaRecorder(stream);
            audioChunks = [];

            mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
            mediaRecorder.onstop = () => {
                const blob = new Blob(audioChunks, { type: "audio/webm" });
                const reader = new FileReader();
                reader.onloadend = () => {
                    ws.send("voice:" + reader.result.split(",")[1]);
                    addChatLine("üé§ Voice message sent!");
                };
                reader.readAsDataURL(blob);
            };

            mediaRecorder.start();
            voiceBtn.classList.add("recording");
        }

        function stopRec() {
            if (mediaRecorder && mediaRecorder.state !== "inactive") {
                mediaRecorder.stop();
                voiceBtn.classList.remove("recording");
            }
        }

        function playVoice(base64Audio) {
            const audio = new Audio(`data:audio/webm;base64,${base64Audio}`);
            const btn = document.createElement("button");
            btn.textContent = "‚ñ∂Ô∏è Play Voice";
            btn.className = "chat-message";
            btn.onclick = () => audio.play();
            chat.appendChild(btn);
            chat.scrollTop = chat.scrollHeight;
            pulseBackground();
        }
    </script>
</body>

</html>